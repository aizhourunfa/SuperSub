# SuperSub 用户指南

欢迎使用 SuperSub！本指南将帮助您快速上手平台的核心功能。

## 目录
1.  [节点管理 (Nodes View)](#1-节点管理-nodes-view)
2.  [订阅管理 (Subscriptions View)](#2-订阅管理-subscriptions-view)
3.  [配置集 (Profiles)](#3-配置集-profiles)
4.  [设置 (Settings)](#4-设置-settings)

---

## 1. 节点管理 (Nodes View)

节点管理是 SuperSub 的基础。您可以在“节点”页面手动添加、编辑和管理您的代理节点。

### 1.1 导入节点

我们推荐使用批量导入功能来快速添加节点。

1.  点击页面右上角的 **“导入节点”** 按钮。
2.  在弹出的窗口中，您可以粘贴一个或多个节点分享链接（如 `vmess://`, `ss://` 等）。系统会自动解析并实时显示节点预览。
    *   `[截图: 批量导入窗口，包含链接输入框和节点预览]`
3.  在导入前，您可以从 **“导入到分组”** 下拉菜单中选择一个已有的分组，将这些新节点直接归入该分组。如果留空，节点将进入“未分组”列表。
4.  点击 **“导入”** 按钮完成操作。

### 1.2 节点分组 (Node Groups)

节点分组是管理大量节点的利器，让您的节点库井井有条。

#### 创建分组

1.  在“节点”页面，点击右上角的 **“新增分组”** 按钮。
2.  在弹出的窗口中输入分组名称，点击“保存”。

#### 管理与操作分组

分组的管理通过页面上方的 **标签页 (Tabs)** 完成。

*   **切换分组**: 单击分组标签，下方列表会只显示该分组下的节点。系统默认提供“全部”和“未分组”两个固定视图。
*   **排序分组**: 在标签页区域，**按住并拖动** 分组标签，即可自由调整它们的显示顺序。
    *   `[动图/截图: 演示拖拽分组标签进行排序]`
*   **高级操作 (菜单)**: **右键点击** 分组标签，或 **单击标签右侧的“更多”图标** (⋮)，会弹出操作菜单。
    *   `[截图: 右键点击分组标签，显示操作菜单]`
    *   **重命名**: 修改分组的名称。
    *   **禁用/启用**: 禁用的分组标签会变灰。这是一个视觉标记，可以帮您区分常用和备用分组。此功能未来可能会与流水线等模块深度集成。
    *   **删除**: 删除分组。请放心，分组下的节点**不会**被删除，它们会自动变为“未分组”状态，您不会丢失任何节点数据。

### 1.3 节点操作

#### 针对单个节点

在节点列表中，每一行都提供了快捷操作：

*   **编辑**: 修改节点的名称、原始链接等信息。
*   **删除**: 删除单个节点。

#### 针对多个节点 (批量操作)

1.  在节点列表中，勾选一个或多个节点。
2.  页面右上角会出现批量操作按钮：
    *   **移动到分组**: 将所有选中的节点一次性移动到另一个分组，或将它们移出当前分组（通过在下拉菜单中清空选择）。
    *   **批量删除**: 一次性删除所有选中的节点。操作不可逆，请谨慎使用。

#### 针对整个分组 (一键操作)

在“节点”页面，您可以对 **当前显示的整个分组** 执行一键操作：

*   **一键排序**: 根据节点的延迟、名称等预设规则对当前分组下的所有节点进行快速排序。
*   **一键去重**: 移除当前分组下的重复节点（基于节点的服务器、端口和协议等关键信息判断）。
*   **一键清空**: 删除当前分组下的 **所有** 节点。这是一个危险操作，请务必确认。

#### 手动拖拽排序

如果您需要自定义节点的顺序：

1.  点击 **“手动排序”** 按钮，节点列表会进入排序模式。
2.  此时，您可以按住每个节点前的 **拖动图标** (⠿)，上下拖拽以调整其在列表中的位置。
3.  调整完毕后，列表上方会出现提示。点击 **“保存排序”** 按钮来持久化您的修改。如果不想保存，点击“取消”即可。
    *   `[动图/截图: 演示拖拽节点进行排序并保存]`

---

## 2. 订阅管理 (Subscriptions View)

订阅管理用于从外部来源（如机场）聚合节点，是自动化获取和更新节点的核心。SuperSub 在此基础上提供了强大的分组、批量处理和规则引擎功能。

*   `[截图: 订阅管理页面全览，高亮显示分组标签页和批量操作按钮]`

### 2.1 订阅分组 (Subscription Groups)

与节点管理类似，您也可以为订阅创建分组，以便于管理和批量操作。

#### 创建与管理分组

1.  **新增分组**: 点击页面右上角的 **“新增分组”** 按钮。
2.  **分组标签页**: 所有分组会以标签页的形式显示在列表上方。
    *   **切换视图**: 点击不同的分组标签，可以只查看该分组下的订阅。
    *   **高级菜单**: **右键点击** 分组标签，或单击标签右侧的 **“更多”图标** (⋮)，会弹出强大的分组操作菜单。
        *   `[截图: 右键点击订阅分组标签，显示操作菜单]`
        *   **更新本组**: 仅更新当前分组下的所有订阅。
        *   **一键去重**: 查找并删除当前分组内所有重复的订阅链接。
        *   **导出订阅**: 将当前分组的所有订阅链接导出为纯文本，方便迁移。
        *   **分组规则**: 为整个分组设置统一的过滤和重命名规则。
        *   **批量替换**: 对分组内所有订阅链接执行“查找与替换”操作，例如统一更换域名。
        *   **重命名/禁用/删除**: 对分组本身进行管理。

### 2.2 核心功能详解

#### a. 智能状态显示

列表中的 **“剩余流量”** 和 **“剩余天数”** 列能让您对套餐情况一目了然。

*   **自动解析**: 点击“更新”时，系统会自动解析并显示这些信息。
*   **颜色预警**:
    *   当剩余天数少于7天或流量较少时，标签会变为 **黄色** ⚠️。
    *   当剩余天数少于3天或流量即将用尽时，标签会变为 **红色** ⛔️。
*   **详细信息**: 将鼠标悬停在标签上，可以查看确切的到期时间和流量数据。

#### b. 批量操作

通过勾选列表中的订阅，您可以执行强大的批量操作：

*   **更新选中**: 仅更新您选中的订阅。
*   **移动到分组**: 将选中的订阅一次性归入某个分组。
*   **批量删除**: 一次性删除所有选中的订阅。

### 2.3 高级更新 (Advanced Update)

点击 **“更新全部”** 或 **“更新选中”** 时，会弹出一个高级更新配置窗口。

*   `[截图: 高级更新配置窗口，显示并发、重试等选项]`

您可以精细调整更新行为：
*   **并发数**: 同时执行多少个更新任务。
*   **失败重试次数**: 每个订阅更新失败后自动重试的次数。
*   **请求间隔**: 错开请求峰值，避免被目标服务器屏蔽。
*   **到期阈值**: 自定义被归类为“即将到期”的天数和流量标准。

*   `[Mermaid 流程图: 规则应用顺序]`
    ```mermaid
    graph TD
        A[更新订阅时] --> B{获取原始节点列表};
        B --> C{检查订阅是否有分组规则?};
        C -->|有| D[应用分组规则];
        C -->|没有| E;
        D --> E{检查订阅是否有自身规则?};
        E -->|有| F[应用订阅自身规则];
        E -->|没有| G;
        F --> G[生成最终节点列表];
    end
    ```
更新完成后，系统会提供一份详细的日志，清晰地列出 **更新成功**、**即将到期** 和 **更新失败** 的订阅列表，并允许您对失败和到期的订阅进行一键重试或清除。

### 2.4 统一规则引擎 (Unified Rules Engine)

规则是 SuperSub 的核心功能之一，允许您在更新时自动处理节点。

*   **统一入口**: 您可以为 **单个订阅** 设置规则，也可以为 **整个订阅分组** 设置规则。
*   **规则类型**:
    *   **关键词过滤/排除**: 根据节点名称包含或不包含某些关键词（如 `香港`, `BGP`）来保留或移除节点。
    *   **正则过滤**: 使用正则表达式进行更复杂的名称匹配。
    *   **正则重命名**: 批量修改节点名称，例如，将 `[HK] Node 01` 统一重命名为 `HK-01`。
*   **执行顺序**: 如果一个订阅同时应用了自身规则和分组规则，系统会先应用 **分组规则**，再应用 **订阅自身规则**。

### 2.5 节点预览 (Node Preview)

在对订阅或规则进行任何修改后，强烈建议使用 **“预览节点”** (👁️) 功能。

*   **实时验证**: 预览窗口会显示该订阅在应用了所有规则后，最终会产生哪些节点。
*   **规则开关**: 在预览窗口中，您可以随时开关“应用处理规则”的选项，以对比原始节点列表和处理后节点列表的差异，这对于调试复杂规则非常有用。
*   **直接导入**: 您甚至可以在预览页面将看到的节点直接作为手动节点导入到您的节点库中。

---

## 3. 配置集 (Profiles)

“配置集”是 SuperSub 的核心，它是您所有努力的最终成果。一个配置集定义了一个“配方”，告诉系统如何将您的各种节点源（订阅、手动节点）组合起来，应用高级策略，并生成一个可供客户端使用的最终订阅链接。

### 3.1 创建与编辑配置集

1.  导航到 **“配置管理”** 页面。
2.  点击 **“新增配置”**，打开配置编辑窗口。
    *   `[截图: 配置集编辑窗口全览，包含多个标签页]`

#### a. 基本信息

*   **名称**: 为您的配置集设置一个易于识别的名称。
*   **链接别名 (Alias)**: **极其重要**。为您配置集设置一个简短、唯一的英文别名（如 `my-clash`）。最终生成的订阅链接将是 `https://<你的域名>/api/public/<令牌>/<别名>`。如果留空，将无法生成公开链接。

#### b. 数据源 (Data Sources)

在这里，您可以选择要包含在此配置集中的所有节点来源。您可以从 **“订阅”** 和 **“手动节点”** 两个列表中勾选任意组合。

#### c. 机场订阅高级策略 (Airport Options)

当您在数据源中选择了多个“订阅”时，可以启用高级策略来控制系统如何从这些订阅中获取节点。这是 SuperSub 最强大的功能之一。

*   `[截图: 机场订阅高级策略配置区域]`

*   **默认 (合并所有 - Use All)**:
    *   **工作原理**: 这是默认行为。系统会获取所有选定订阅的节点，并将它们合并在一起。
    *   **适用场景**: 希望聚合多个来源的节点以获得最大节点池。

*   **智能获取 (Smart Fetch)**:
    *   **工作原理**: 系统会**按顺序**尝试更新您选择的订阅，一旦有一个订阅成功返回节点，就立即停止并使用该订阅的节点。
    *   **适用场景**: 主备切换。将最稳定、最常用的订阅放在列表顶部，备用订阅放在后面。当主订阅失效时，系统会自动切换到下一个备用订阅。

*   **轮询 (Polling)**:
    *   **工作原理**: 每次客户端请求订阅时，系统会从您的订阅列表中按顺序选择下一个。例如，第一次返回A订阅，第二次返回B，第三次返回C，然后回到A。
    *   **模式**:
        *   **按请求 (request)**: 每次订阅链接被请求时轮询。
    *   `[Mermaid 流程图: 按组轮询]`
        ```mermaid
        graph TD
            subgraph "按组轮询 (Group Polling)"
                A[开始] --> B{获取所有选中的订阅};
                B --> C{按“订阅分组”对订阅进行归类};

                subgraph 分组 1
                    C1[订阅 1-1]
                    C2[订阅 1-2]
                end

                subgraph 分组 2
                    D1[订阅 2-1]
                    D2[订阅 2-2]
                end

                C --> C1 & D1;

                subgraph "并行处理"
                    direction LR
                    subgraph "分组 1 内部轮询"
                        P1[尝试获取 1-1] -->|失败| P2[尝试获取 1-2];
                        P2 -->|失败| P3[分组1无结果];
                        P1 -->|成功| R1[获取到分组1的节点];
                    end
                    subgraph "分组 2 内部轮询"
                        Q1[尝试获取 2-1] -->|失败| Q2[尝试获取 2-2];
                        Q2 -->|失败| Q3[分组2无结果];
                        Q1 -->|成功| R2[获取到分组2的节点];
                    end
                end

                R1 & R2 --> F[合并所有成功分组的节点];
                F --> G[生成最终订阅];
            end
        end
        ```
        *   **按小时 (hourly)**: 每小时切换到下一个订阅。
    *   **适用场景**: 在多个机场之间实现自动负载均衡，避免单个机场长期承载所有流量。

*   **按组轮询 (Group Polling)**:
    *   **工作原理**: 这是轮询的增强版。系统会根据您在“订阅管理”中设置的 **订阅分组**，在 **每个分组内** 并行地执行轮询。最终，它会合并每个分组成功获取到的节点列表。
    *   **适用场景**: 终极高可用方案。例如，您有“主力机场”和“备用机场”两个分组，每个分组内有多个订阅。此模式能确保即使某个分组内的所有订阅都失效，您仍然能从其他分组获取节点。

*   **随机 (Random)**:
    *   **工作原理**: 每次请求订阅时，从您选择的订阅列表中**随机**挑选一个返回。
    *   **适用场景**: 不希望暴露固定的订阅源，或希望每次更新都能有“新鲜感”。

#### d. 节点前缀处理 (Node Prefix)

在这里为节点名称添加统一的前缀，方便在客户端中识别和分组。

*   **订阅节点前缀**: 开启后，来自订阅的节点名称会变为 `订阅名称 - 原始节点名称`。
*   **手动节点前缀**:
    *   **使用分组名**: 开启后，手动节点的名称会变为 `节点分组名 - 原始节点名称`。
    *   **自定义前缀**: 如果不使用分组名，可以设置一个统一的自定义前缀。

#### e. 生成设置 (在线转换)

此部分定义了如何将您选择的节点转换为客户端可以识别的格式。

*   **转换后端 (Backend)**: 选择一个 `subconverter` 服务地址。
*   **转换配置 (Config)**: 选择一个 `subconverter` 配置文件模板，它决定了最终输出的代理组、分流规则等。

### 3.2 预览与获取链接

*   **预览 (Preview)**: 在配置集列表中，点击“预览”图标 (👁️)，可以打开一个强大的分析窗口。
    *   `[截图: 配置集预览窗口，包含统计图表和节点列表]`
    *   **功能**:
        *   查看该配置集在当前设置下最终会生成哪些节点。
        *   查看 **统计分析**，包括节点总数、协议分布和地区分布，以图表形式直观展示。
    *   **用途**: 在发布前进行最终检查，确保数据源、高级策略和规则都按预期工作。

*   **获取链接**: 点击“复制”图标 (📋)，即可将生成的订阅链接复制到剪贴板。

---

## 4. 设置 (Settings)

设置页面允许您对系统的全局行为进行配置。

### 4.1 通用设置

*   **Telegram 通知**:
    *   您可以配置一个 Telegram Bot，让 SuperSub 在执行某些操作（未来规划）后向您发送通知。
    *   **Bot Token**: 您的 Telegram Bot 的 Token。
    *   **Chat ID**: 您希望接收通知的个人、频道或群组的 ID。
    *   配置完成后，可以点击 **“发送测试通知”** 来验证设置是否正确。

### 4.2 订阅转换设置

此页面用于管理“在线转换”所依赖的全局资源。在这里进行的设置，将作为所有“配置集”的默认选项。

*   **订阅转换后端管理**:
    *   “后端”指的是 `subconverter` 服务的 URL。
    *   系统内置了一些公共服务，您也可以添加自己的私有服务。
    *   您可以将任何一个后端设置为 **“默认”**。在“配置集”中未指定后端时，将使用此默认后端。

*   **订阅转换配置管理**:
    *   “配置”指的是 `subconverter` 在转换时所依据的配置文件（通常是一个 `.ini` 文件）的 URL。这个文件定义了 Clash 代理组、分流规则等高级行为。
    *   系统内置了许多常用的在线配置，您也可以添加自己的配置。
    *   同样，您可以将任何一个配置设置为 **“默认”**。