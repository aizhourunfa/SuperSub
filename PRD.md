# SuperSub - 产品需求文档 (PRD)

**版本**: 2.0
**日期**: 2025-09-27

## 1. 概述

### 1.1. 项目愿景

SuperSub 旨在成为一个强大、灵活且易于使用的代理订阅转换与管理平台。它使用户能够聚合多个订阅源，通过自定义规则进行处理，并根据模板生成适用于各种客户端的最终配置文件。

### 1.2. 核心价值

项目的核心价值在于其 **“流水线” (Pipeline)** 概念。用户可以将不同的构建块（订阅、规则、模板）自由组合，创建出高度定制化的数据处理流程，从而一站式解决订阅管理和分发的复杂需求。

## 2. 功能需求

### 2.1. 仪表盘 (Dashboard)

- **目的**: 提供系统状态的概览。
- **需求**:
  - 显示节点、订阅、规则、模板和流水线的总数统计。
  - 展示最近的健康检查状态。
  - 提供快速访问其他主要功能的入口。

### 2.2. 节点管理 (Nodes)

- **目的**: 手动管理单个代理节点。
- **需求**:
  - **添加节点**: 支持手动输入节点信息，包括名称、地址、端口、协议类型等。
  - **编辑节点**: 修改现有节点的详细信息。
  - **删除节点**: 从系统中移除单个节点。
  - **健康检查**:
    - 对单个节点执行手动健康检查。
    - 对所有或选定节点执行批量健康检查。
  - **显示**: 以列表形式清晰展示节点的名称、协议、延迟和健康状态。
  - **分组管理**:
    - **创建分组**: 允许用户创建自定义的分组来组织节点。
    - **重命名/删除分组**: 用户可以修改分组名称或删除不再需要的分组。
    - **排序分组**: 支持拖拽调整分组的显示顺序。
    - **启用/禁用分组**: 可以临时禁用某个分组，这可能会影响其在其他功能模块（如流水线）中的可见性。
    - **节点归属**: 支持将节点批量移动到指定分组，或从分组中移除。导入节点时也可直接指定分组。

### 2.3. 订阅管理 (Subscriptions)

- **目的**: 从外部来源聚合节点。
- **需求**:
  - **添加订阅**: 支持添加远程订阅链接（例如 V2Ray, Clash 订阅）。
  - **更新订阅**: 手动或自动（未来功能）从远程链接更新节点列表。
  - **显示**: 列出所有订阅及其包含的节点数量和最后更新时间。

### 2.4. 订阅规则 (Subscription Rules)

- **目的**: 定义如何处理从订阅中获取的节点。
- **需求**:
  - **创建规则集**:
    - **过滤 (Filter)**: 根据节点名称、协议类型等关键词包含或排除节点。
    - **重命名 (Rename)**: 使用正则表达式对节点名称进行批量重命名。
    - **排序 (Sort)**: 根据名称或延迟对节点进行排序。
  - **管理规则**: 创建、编辑、删除规则集。

### 2.5. 配置模板 (Config Templates)

- **目的**: 定义最终输出的配置文件格式。
- **需求**:
  - **创建模板**:
    - 支持为不同客户端（如 Clash, V2RayN）创建模板。
    - 模板编辑器应允许用户编写包含特定变量（如 `{{.Nodes}}`）的文本。
  - **管理模板**: 创建、编辑、删除模板。
  - **内置模板**: 提供一些常用客户端的默认模板。

### 2.6. 配置集 (Profiles)

- **目的**: 将所有数据源（订阅、手动节点）组合成一个可供客户端使用的最终订阅链接。
- **需求**:
  - **创建配置集**:
    - **选择数据源**: 允许用户从已有的“订阅”和“手动节点”中自由选择任意组合作为数据来源。
    - **设置生成方式**: 支持“在线转换”模式，用户可以选择一个全局或自定义的“转换后端”和“转换配置”。
    - **设置链接别名**: 允许用户为生成的链接自定义一个易于记忆的短链。
  - **生成链接**: 每个配置集都会生成一个唯一的、可公开访问的 URL。
  - **管理配置集**: 创建、编辑、删除配置集。
  - **预览**: 在生成链接前，可以预览该配置集最终包含的节点列表和统计信息。

### 2.7. 用户系统

- **目的**: 提供多用户隔离和安全性。
- **需求**:
  - 用户注册和登录。
  - 基于 JWT 的安全认证。
  - 所有资源（节点、订阅等）都与特定用户绑定。

## 3. 用户故事

- **作为一名普通用户**，我希望能将我的多个机场订阅合并成一个，并过滤掉我不想要的地区节点，然后生成一个可以在我的 Clash 客户端中直接使用的配置文件链接。
- **作为一名高级用户**，我希望能编写自己的配置模板，精确控制输出文件的代理组（Proxy Group）和规则（Rule），并对节点进行复杂的重命名操作。
- **作为一名重度节点使用者**，我希望可以将我手动添加的几十个节点按照地区（如“香港节点”、“日本节点”）进行分组，方便我管理和查找，并且可以在不同的流水线中只使用特定分组的节点。

## 4. 非功能性需求

- **性能**: 后端 API 响应时间应低于 200ms。流水线生成的订阅链接应能快速响应。
- **安全**: 所有用户数据必须隔离。API 必须经过身份验证。防止常见的 Web 漏洞（XSS, CSRF）。
- **易用性**: UI 应直观、简洁，主要工作流程应清晰明了。

## 5. 技术架构

- **前端**: Vue 3 (Composition API), Naive UI, Pinia, Vite
- **后端**: Cloudflare Workers, Hono
- **数据库**: Cloudflare D1
- **部署**: Cloudflare Pages